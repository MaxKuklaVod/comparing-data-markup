# Отчет по развертыванию, использованию и проверке CVAT

## 1. Развертывание CVAT

### 1.1. Предварительные требования
*   Установленный Docker и Docker Compose. (Например, Docker Desktop для Windows/Mac или отдельные установки Docker Engine и Docker Compose для Linux).
*   Установленный Git для клонирования репозитория CVAT.
*   Доступ в Интернет для скачивания образов CVAT.
*   Python 3.x с установленными библиотеками (например, `Pillow`, `xml.etree.ElementTree` или `json`, `opencv-python`) для скрипта визуализации, в зависимости от выбранного формата экспорта.

### 1.2. Выбор способа развертывания
Для локального развертывания был выбран официальный рекомендованный способ с использованием Docker Compose. Этот метод позволяет запустить все необходимые сервисы CVAT (веб-сервер, базу данных, Redis, воркеры и т.д.) и обеспечивает сохранение данных с помощью именованных Docker-томов.

### 1.3. Шаги развертывания

1.  **Клонирование официального репозитория CVAT:**
    ```bash
    git clone https://github.com/cvat-ai/cvat.git
    cd cvat
    ```

2.  **Запуск CVAT с помощью Docker Compose:**
    Команда, выполненная в директории `cvat`:
    ```bash
    docker compose up -d
    ```
    **Разбор команды:**
    *   `docker compose up`: запускает сервисы, определенные в `docker-compose.yml` (и `docker-compose.override.yml`, если он есть).
    *   `-d`: запуск в фоновом (detached) режиме.

    **Основные сервисы, запущенные CVAT (согласно `docker-compose.yml`):**
    *   `cvat_server`: основной Django-сервер приложения.
    *   `cvat_db`: база данных PostgreSQL.
    *   `redis`: кэш и брокер сообщений.
    *   `cvat_worker_annotation`, `cvat_worker_import`, `cvat_worker_export`: воркеры для фоновых задач.
    *   `cvat_ui`: frontend (React).
    *   `traefik`: реверс-прокси и балансировщик.

3.  **Проверка статуса контейнеров:**
    Командой `docker compose ps` был проверен успешный запуск всех контейнеров.

4.  **Создание аккаунта суперпользователя:**
    Поскольку CVAT не предлагает создание пользователя через UI при первом запуске, суперпользователь был создан через командную строку:
    ```bash
    docker exec -it cvat_server /bin/bash -ic "python3 ~/manage.py createsuperuser"
    ```
    Далее были введены имя пользователя, email и пароль.

5.  **Доступ к CVAT:**
    CVAT стал доступен в браузере по адресу `http://localhost:8080`. Вход выполнен с использованием учетных данных суперпользователя.

### 1.4. Сохранение данных
CVAT использует именованные Docker-тома для сохранения данных, что обеспечивает их персистентность между перезапусками контейнеров. Основные тома (из `docker-compose.yml`):
*   `cvat_db`: данные PostgreSQL.
*   `cvat_data`: загруженные файлы, логи, специфичные данные задач.
*   `cvat_keys`: ключи доступа.
*   `cvat_logs`: логи сервера.
*   `redis_data`: данные Redis.

### 1.5. Сложности и решения при развертывании и настройке

*   **Сложность 1: Конфликт портов**
    *   **Симптом:** CVAT не запускался или был недоступен по `http://localhost:8080`. Логи `docker compose logs traefik` (или `cvat_proxy`) показывали ошибку привязки к порту.
    *   **Причина:** Порт 8080 был занят другим приложением.
    *   **Решение:** Был создан файл `.env` в корневой директории `cvat` со следующим содержимым для смены порта UI на 8081:
        ```env
        CVAT_PORT=8081
        ```
        Затем контейнеры были перезапущены: `docker compose down && docker compose up -d`. CVAT стал доступен по `http://localhost:8081`.

*   **Сложность 2: Нехватка ресурсов Docker**
    *   **Симптом:** Некоторые контейнеры CVAT падали или работали нестабильно.
    *   **Причина:** Недостаточно RAM или CPU, выделенных Docker Desktop.
    *   **Решение:** В настройках Docker Desktop были увеличены лимиты ресурсов (RAM до X GB, CPU до Y ядер).

*   **Замечание по начальной настройке:** Интерфейс CVAT, в отличие от Label Studio, показался менее интуитивным для нового пользователя. Например, создание иерархии Проект -> Задача -> Работа (Job) потребовало некоторого времени на осмысление, тогда как в Label Studio создание проекта и импорт данных ощущались более прямолинейными.

## 2. Тестовая разметка

### 2.1. Создание проекта и задачи
*   **Проект:** В разделе "Projects" был создан новый проект с именем "Cats".
*   **Задача:** Внутри проекта была создана задача (Task).
    *   **Замечание по настройке задачи:** Процесс добавления файлов и меток к задаче в CVAT показался более многошаговым и менее очевидным по сравнению с Label Studio. Концепция отдельных "Jobs" внутри задачи также требует привыкания.

### 2.2. Подготовка и импорт датасета
*   **Данные:** Взято 14 изображений кошек как и для Label Studio.
*   **Источник:** Изображения были собраны с бесплатных фотостоков (Pexels, Unsplash).
*   **Формат:** `.jpg`.
*   **Импорт:** Изображения были загружены в задачу через интерфейс CVAT ("Select files" -> "My computer").

### 2.3. Настройка меток (Labels)
Для задачи детекции объектов (bounding boxes) в конструкторе меток задачи были определены следующие классы:
```
- Label 1:
  - Name: Cat
  - Type: Rectangle
- Label 2:
  - Name: Cats
  - Type: Rectangle
```

### 2.4. Выполнение разметки
*   Все 14 импортированных изображений были открыты в рамках соответствующей работы (Job).
*   Для каждого изображения были размечены объекты выбранных классов с использованием инструмента "Draw new rectangle" (`N` -> `R`).
*   **Замечание по интерфейсу разметки:** Хотя основные инструменты (прямоугольник, полигон) работают хорошо, навигация и некоторые неочевидные горячие клавиши или отсутствие интуитивно понятных подсказок для всех действий замедляли процесс на начальном этапе. Например, автоматический переход к следующему кадру после сохранения или выбор инструмента по умолчанию не всегда был ожидаемым.

## 3. Экспорт и проверка разметки

### 3.1. Экспорт данных
*   После завершения разметки, аннотации были экспортированы со страницы задачи.
*   **Формат экспорта:** **CVAT for Image (XML)**.
*   Архив с файлом `annotations.xml` ии зображениями был скачан и распакован.

### 3.2. Проверка разметки с помощью Python-скрипта
Для визуальной проверки корректности экспортированных аннотаций в формате XML был разработан/адаптирован Python-скрипт.

**Ключевые особенности и сложности при разработке скрипта:**

1.  **Структура XML:** Формат COCO имеет свою специфическую структуру:
    *   `images`: список изображений с их `id`, `file_name`, `width`, `height`.
    *   `annotations`: список всех аннотаций, где каждая аннотация связана с изображением через `image_id` и с категорией через `category_id`. Bounding box задается в формате `[x, y, width, height]`.
    *   `categories`: список категорий (меток) с их `id` и `name`.
    *   Скрипту необходимо сопоставить аннотации с изображениями и категориями.

2.  **Пути к изображениям:** Убедиться, что `file_name` из XMl корректно сопоставляется с локальным путем к файлам изображений.

**Результат проверки:** Визуализация с помощью скрипта подтвердила, что аннотации (bounding boxes и, опционально, полигоны) были сделаны в целом корректно для выбранных классов.

## 4. Впечатления от первого опыта использования CVAT

*   **Удобство интерфейса:**
    *   **Развертывание и базовая навигация:** Сам процесс развертывания через Docker Compose довольно прост, если следовать документации. Однако, первоначальная навигация по интерфейсу CVAT (проекты, задачи, работы, пользователи, облачные хранилища) требует времени на освоение и не всегда интуитивно понятна, особенно для пользователей, привыкших к более простым интерфейсам вроде Label Studio.
    *   **Интерфейс разметки:** Инструменты разметки (прямоугольники, полигоны) функциональны и предлагают много опций (атрибуты, отслеживание). Горячие клавиши значительно ускоряют работу после их изучения. Однако, без предварительного изучения документации или туториалов, некоторые функции и оптимальные рабочие процессы могут остаться неочевидными.

*   **Понятность настроек:**
    *   **Создание проекта/задачи:** Процесс создания задач и настройки меток в CVAT ощущается более "инженерным" и менее дружелюбным к новичку по сравнению с Label Studio. Конструктор меток мощный, но его интерфейс мог бы быть более наглядным. Разделение на "Задачи" и "Работы" (Jobs) вносит дополнительный уровень сложности, который не всегда нужен для простых проектов.
    *   **Экспорт данных:** Опций экспорта много, что хорошо. Выбор формата XML был понятен.

*   **Возникшие вопросы или трудности при самой разметке и работе:**
    *   **Первоначальная кривая обучения:** Основная трудность заключалась в привыкании к философии и структуре CVAT. Некоторые действия, которые в других инструментах выполняются в один-два клика, в CVAT могут требовать навигации по нескольким меню или понимания специфической логики.

*   **Сравнение с Label Studio:**
    *   **Установка:** Оба инструмента легко разворачиваются через Docker. CVAT с Docker Compose может показаться чуть сложнее из-за множества сервисов, но это стандартная практика.
    *   **Импорт данных и настройка задачи:** Label Studio выигрывает в простоте и интуитивности для быстрого старта простого проекта. CVAT предлагает более гранулярный контроль, но ценой более крутой кривой обучения для базовых операций.
    *   **Интерфейс разметки:** Для сложных задач и опытных разметчиков CVAT предлагает более продвинутые инструменты и опции (например, интерполяция треков, атрибуты сложной структуры). Label Studio проще для базовой разметки. CVAT кажется более ориентированным на производственные процессы разметки.
    *   **Экспорт данных:** Оба инструмента поддерживают популярные форматы. CVAT имеет более широкий нативный список форматов.
    *   **Общее впечатление:**
        *   **Label Studio:** Отличный выбор для быстрого старта, небольших и средних проектов, где важна простота и гибкость настройки интерфейса через XML "на лету". Более дружелюбен к новичкам.
        *   **CVAT:** Мощный, многофункциональный инструмент, больше подходящий для крупных проектов, командной работы, задач, требующих продвинутых функций разметки (например, видео-аннотации, интерполяция, кубоиды). Требует больше времени на освоение, интерфейс менее интуитивен для новых пользователей, но предлагает более строгую организацию и контроль.

## 5. Заключение
Задача по развертыванию CVAT, выполнению разметки датасета, экспорту и проверке данных успешно выполнена. Получен практический опыт работы с CVAT, который показал его как мощный, но требующий определенного времени на освоение инструмент. Процесс задокументирован в данном отчете. Для простых задач и быстрого старта Label Studio может быть предпочтительнее из-за своей интуитивности, в то время как CVAT лучше подходит для более сложных и масштабных проектов разметки.
