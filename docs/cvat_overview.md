# Руководство по CVAT (Computer Vision Annotation Tool): Начало работы

## 1. Введение в CVAT

**CVAT (Computer Vision Annotation Tool)** – это мощный, интерактивный, open-source инструмент для аннотирования изображений и видео, разработанный с особым акцентом на задачи компьютерного зрения (CV). Он предоставляет профессиональные возможности для создания высококачественных наборов данных для обучения моделей машинного обучения.

*   **Основное назначение:**
    Обеспечение комплексного и эффективного решения для разметки визуальных данных (изображений и видео) для широкого спектра задач компьютерного зрения.

*   **Ключевые особенности и преимущества:**
    *   **Глубокая специализация на компьютерном зрении:** Интерфейс и функционал оптимизированы для задач детекции объектов, семантической и инстанс-сегментации, отслеживания объектов на видео, разметки кубоидами и ключевыми точками.
    *   **Эффективная работа с видеоданными:**
        *   Плавная навигация по кадрам.
        *   **Интерполяция аннотаций:** Автоматическое создание аннотаций на промежуточных кадрах между двумя размеченными вручную ключевыми кадрами, что значительно ускоряет разметку движущихся объектов.
        *   **Трекинг объектов:** Возможность присваивать уникальные идентификаторы объектам и отслеживать их на протяжении видеопоследовательности.
    *   **Разнообразие инструментов аннотирования:**
        *   Прямоугольники (Bounding Boxes)
        *   Многоугольники (Polygons)
        *   Полилинии (Polylines)
        *   Кубоиды (3D Bounding Boxes)
        *   Точки (Keypoints)
        *   Кисти и "умные" инструменты для создания масок сегментации.
    *   **Настраиваемые атрибуты меток:** Возможность добавлять к каждой метке (классу) и к каждому экземпляру аннотации кастомные атрибуты (например, "окклюдирование", "цвет", "направление движения") различные типы (чекбокс, текст, число, выбор из списка).
    *   **Интеграция с ML-моделями для автоматизации (AI Tools):**
        *   **Интерактивная сегментация:** Встроенные инструменты (например, на основе SAM, DEXTR), позволяющие быстро выделять объекты по нескольким кликам.
        *   **Автоматическая детекция и предразметка:** Возможность подключения и использования предварительно обученных моделей для автоматического создания аннотаций, которые затем проверяются и корректируются человеком.
        *   Поддержка развертывания моделей через Nuclio, OpenVINO™ Model Server и другие платформы.
    *   **Веб-интерфейс:** Доступ через браузер, что упрощает командную работу и не требует установки ПО на машины разметчиков.
    *   **Открытый исходный код (Open-source):** Распространяется под лицензией MIT, активно поддерживается и развивается сообществом, включая Intel и OpenCV.
    *   **Управление проектами и задачами:** Структурирование работы через проекты, задачи (Tasks) и работы (Jobs), где задачи могут быть разделены на более мелкие "работы" для параллельного выполнения несколькими аннотаторами.
    *   **Поддержка различных форматов данных:** Широкий спектр поддерживаемых форматов для импорта и экспорта аннотаций (COCO, Pascal VOC, YOLO, MOT и др.).

## 2. Типичный рабочий процесс (Workflow)

Стандартный процесс работы с данными в CVAT включает следующие этапы:

1.  **Установка и запуск** CVAT (рекомендуется через Docker Compose).
2.  **Создание новой Задачи (Task)**, определение ее параметров и меток.
3.  **Загрузка данных** (изображений или видео) в созданную задачу.
4.  **Настройка меток (Labels)** и их атрибутов для аннотирования.
5.  **Открытие Работы (Job)**, которая является частью Задачи и назначается аннотатору.
6.  **Разметка данных** с использованием разнообразных инструментов аннотирования, предоставляемых CVAT.
7.  **Регулярное сохранение аннотаций** (CVAT также имеет функцию автосохранения).
8.  **Экспорт размеченных данных (аннотаций)** в одном из множества поддерживаемых форматов.

## 3. Установка (Installation)

Основной и наиболее рекомендуемый способ установки и запуска CVAT – **с использованием Docker и Docker Compose**. Это обеспечивает корректную работу всех компонентов системы.

1.  **Предварительные требования:** Установленные Docker и Docker Compose.
2.  **Клонировать официальный репозиторий CVAT:**
    ```bash
    git clone https://github.com/cvat-ai/cvat   # Ранее репозиторий был opencv/cvat
    cd cvat
    ```
3.  **Запустить все сервисы CVAT с помощью Docker Compose:**
    ```bash
    docker compose up -d
    ```
    Эта команда скачает необходимые Docker-образы (если их нет локально), соберет и запустит все сервисы, включая веб-интерфейс CVAT, серверную часть, базу данных PostgreSQL, кэш Redis, а также опциональные компоненты для AI-инструментов, такие как OpenVINO™ Model Server и Nuclio.

4.  **Создание суперпользователя (при первом запуске):**
    После успешного запуска контейнеров, необходимо создать учетную запись администратора (суперпользователя) для доступа к системе:
    ```bash
    docker compose exec cvat_server bash -ic "python3 ~/manage.py createsuperuser --username <ваш_логин> --email <ваш_email>"
    ```
    Следуйте инструкциям в консоли для ввода пароля.

После выполнения этих шагов CVAT будет доступен в вашем веб-браузере по адресу `http://localhost:8080` (если порт 8080 не занят).

Существует также облачный сервис **[CVAT.ai](https://www.cvat.ai/)**, который предоставляет CVAT как управляемую услугу, избавляя от необходимости самостоятельной установки и обслуживания серверной инфраструктуры.

## 4. Создание Задачи (Creating a Task)

Задачи в CVAT являются основными единицами для организации разметки.

1.  Войдите в CVAT, используя учетные данные суперпользователя (или другого пользователя с соответствующими правами).
2.  На панели навигации перейдите в раздел **"Tasks"** (Задачи).
3.  Нажмите кнопку **"+ Create new task"** (Создать новую задачу).
4.  **Заполните основную информацию о задаче:**
    *   **Name:** Укажите осмысленное имя для задачи (например, "Детекция дорожных знаков - Партия 1").
    *   **Project (Проект):** Можно привязать задачу к существующему проекту для лучшей организации или оставить поле пустым.
    *   **Labels (Метки):**
        *   Нажмите **"Add label"** или используйте конструктор меток.
        *   Введите имя метки (например, "Car", "Pedestrian", "Traffic_Light").
        *   Выберите цвет для визуального различения метки.
        *   **Attributes (Атрибуты):** Для каждой метки можно добавить атрибуты (например, для метки "Car" можно добавить атрибут "Цвет" с типом "select" и значениями "Красный", "Синий", "Черный", или атрибут "Окклюдирован" с типом "checkbox").
        *   После настройки всех меток и их атрибутов нажмите "Done" в конструкторе.
    *   **Files (Файлы):** Загрузите ваши изображения или видеофайлы. CVAT поддерживает загрузку:
        *   **My computer:** Файлы с вашего локального диска.
        *   **Connected file share:** Файлы из подключенной на сервере файловой шары.
        *   **Remote source:** Список URL-адресов файлов.
5.  **Advanced configuration (Расширенные настройки - опционально):**
    *   **Use zip chunks:** Для загрузки больших архивов.
    *   **Image quality:** Качество отображения изображений в интерфейсе.
    *   **Overlap size / Segment size:** Если задача большая, ее можно автоматически разделить на несколько "Работ" (Jobs) указанного размера с возможностью перекрытия для обеспечения согласованности на границах сегментов.
    *   **Frame step (для видео):** Шаг извлечения кадров из видео для аннотирования.
6.  После заполнения всех необходимых полей нажмите **"Submit & Open"** (для немедленного перехода к разметке первой работы) или **"Submit & Continue"** (для создания задачи и возврата к списку задач).

Созданная задача обычно содержит одну или несколько **Работ (Jobs)**, которые назначаются разметчикам.

## 5. Импорт данных и аннотаций (Data and Annotation Import)

*   **Импорт данных (изображений/видео):** Осуществляется на этапе создания задачи, как описано выше.
*   **Импорт существующих аннотаций:**
    CVAT позволяет импортировать аннотации для уже загруженных данных, если они у вас есть в одном из поддерживаемых форматов. Это можно сделать, выбрав соответствующий формат в разделе "Upload annotations" при создании или редактировании задачи. Поддерживаемые форматы включают:
    *   CVAT XML/ZIP
    *   COCO JSON
    *   Pascal VOC XML
    *   YOLO TXT
    *   И другие.

*   **Подключение облачных хранилищ:**
    CVAT может быть сконфигурирован для работы с облачными хранилищами, такими как Amazon S3, Google Cloud Storage или Microsoft Azure Blob Storage. Это позволяет напрямую загружать данные из облака и экспортировать результаты обратно. Настройка облачных хранилищ обычно выполняется администратором системы CVAT через конфигурационные файлы или переменные окружения сервера.

## 6. Интеграция с машинным обучением (ML Integration / Automatic Annotation)

CVAT предоставляет мощные встроенные возможности для интеграции с ML-моделями, что позволяет автоматизировать и ускорять процесс разметки:

*   **Интерактивные инструменты сегментации ("Interactors"):**
    *   Доступны через иконку волшебной палочки (`🪄`) на панели инструментов.
    *   Позволяют быстро создавать маски сегментации для объектов, указывая несколько положительных и отрицательных точек.
    *   Поддерживаются модели, такие как Deep Extreme Cut (DEXTR), f-BRS, RITM, а также **Segment Anything Model (SAM)**, который может генерировать маску по одному или нескольким кликам, или по ограничивающей рамке.
*   **Автоматическая аннотация с помощью моделей ("Detectors", "Classifiers", etc.):**
    *   В разделе "AI Tools" (или "Models" в старых версиях) на панели инструментов можно выбрать и запустить предварительно обученные или кастомные ML-модели.
    *   Модели могут выполнять задачи:
        *   **Детекция объектов:** Автоматическое создание Bounding Boxes.
        *   **Классификация изображений:** Присвоение тегов изображениям.
        *   **Семантическая/Инстанс-сегментация:** Генерация масок.
        *   **Трекинг объектов на видео.**
*   **Механизмы интеграции моделей:**
    *   **Nuclio Serverless Platform:** CVAT тесно интегрирован с Nuclio, что позволяет развертывать ML-модели как серверлесс-функции (обычно на Python). CVAT поставляется с набором готовых функций для популярных моделей.
    *   **OpenVINO™ Model Server (OVMS):** Позволяет эффективно обслуживать модели, оптимизированные с помощью OpenVINO™.
    *   Пользователи могут добавлять свои собственные модели, следуя документации CVAT по интеграции ML-бэкендов.

Использование этих инструментов может значительно сократить время, затрачиваемое на ручную разметку.

## 7. Экспорт аннотаций (Data Export)

После завершения разметки (или на любом этапе) аннотации можно экспортировать:

1.  На странице Задачи (Task) или в общем списке Задач.
2.  Напротив нужной задачи нажмите кнопку **"Actions" (Действия)** и выберите **"Export task dataset" (Экспортировать датасет задачи)**. (Для экспорта аннотаций всего проекта, если задачи объединены в проект, выберите "Export project dataset").
3.  **Выберите формат экспорта.** CVAT поддерживает обширный список форматов, ориентированных в основном на задачи компьютерного зрения:
    *   **CVAT for images / CVAT for video (XML):** Нативный формат, сохраняющий всю структуру данных CVAT.
    *   **COCO JSON 1.0:** Широко используемый стандарт для задач детекции, сегментации, ключевых точек.
    *   **Pascal VOC XML:** Классический формат для детекции объектов.
    *   **YOLO (TXT):** Формат для моделей семейства YOLO.
    *   **MOT (Multiple Object Tracking) TXT:** Для задач отслеживания объектов.
    *   **Segmentation Mask (PNG):** Экспорт масок сегментации в виде изображений.
    *   **LabelMe 3.0 XML, ImageNet, CamVid, Cityscapes** и многие другие специфичные форматы.
4.  Можно также выбрать опцию **"Save images"** для включения исходных изображений в экспортируемый ZIP-архив.
5.  Нажмите "OK". CVAT подготовит ZIP-архив с аннотациями (и изображениями, если выбрано), который затем можно будет скачать.

## 8. Ключевые преимущества CVAT (Резюме)

*   **Специализация на компьютерном зрении:** Оптимизированный интерфейс и инструменты для задач разметки изображений и видео.
*   **Продвинутое видеоаннотирование:** Мощные инструменты для работы с видео, включая интерполяцию и трекинг объектов.
*   **Встроенные AI-инструменты:** Широкие возможности для полуавтоматической и автоматической разметки с использованием ML-моделей (SAM, детекторы и др.) "из коробки".
*   **Поддержка командной работы:** Система пользователей, разделение задач на работы, возможность назначения ревьюеров.
*   **Стабильность и активная поддержка:** Развивается при поддержке Intel и OpenCV, имеет большое и активное сообщество.
*   **Богатый выбор форматов экспорта:** Совместимость с большинством популярных фреймворков и датасетов для CV.
