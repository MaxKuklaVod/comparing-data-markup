# Руководство по Label Studio: Начало работы

## 1. Введение в Label Studio

**Label Studio** – это популярный open-source инструмент для аннотирования (разметки) данных. Он предоставляет универсальный и гибкий интерфейс для подготовки наборов данных, необходимых для обучения моделей машинного обучения (МО).

*   **Основное назначение:**
    Обеспечение единой платформы для аннотирования различных типов данных, включая изображения, текст, аудио, видео, временные ряды, HTML-документы и другие форматы.

*   **Ключевые особенности и преимущества:**
    *   **Универсальность и поддержка мультимодальных данных:** Способность работать с широким спектром типов данных и задач разметки в одном инструменте.
        *   **Изображения:** Классификация, детекция объектов (Bounding Boxes, Polygons), семантическая и инстанс-сегментация, разметка ключевых точек.
        *   **Текст:** Извлечение именованных сущностей (NER), классификация текста, анализ тональности, разметка отношений, ответы на вопросы.
        *   **Аудио:** Транскрипция речи, классификация звуков, диаризация говорящих, разметка эмоций.
        *   **Видео:** Отслеживание объектов, покадровая разметка, классификация видео-сегментов.
        *   **Временные ряды:** Сегментация, разметка событий.
        *   **HTML:** Разметка веб-страниц и структурированных документов.
    *   **Гибкая настройка интерфейса разметки (Labeling Interface):** С помощью XML-подобного языка конфигурации или интуитивного визуального конструктора (Visual Labeling Configurator) можно создавать практически любой пользовательский интерфейс, идеально подходящий под специфику конкретной задачи разметки.
    *   **Интеграция с моделями машинного обучения (ML Backends):**
        *   **Предварительная разметка (Pre-annotation):** Возможность подключения ML-моделей для автоматического создания начальных аннотаций, которые затем проверяются и корректируются человеком.
        *   **Активное обучение (Active Learning):** Поддержка сценариев, когда модель помогает выбирать наиболее информативные данные для разметки, оптимизируя усилия аннотаторов.
        *   **Непрерывное дообучение:** Создание циклов, где размеченные данные используются для улучшения модели, которая затем предоставляет более качественные предсказания.
    *   **Открытый исходный код (Open-source):** Распространяется под лицензией Apache 2.0, что обеспечивает бесплатное использование, возможность модификации и адаптации под собственные нужды, а также активное развитие благодаря большому сообществу.
    *   **Поддержка командной работы и контроля качества:** Функционал для организации работы нескольких аннотаторов над одним проектом, распределения задач, а также механизмы для проверки и валидации аннотаций (например, консенсус или ревью).

## 2. Типичный рабочий процесс (Workflow)

Стандартный процесс работы с данными в Label Studio включает следующие этапы:

1.  **Установка и запуск** Label Studio на локальной машине или сервере.
2.  **Создание нового проекта,** определяющего тип данных и задачу разметки.
3.  **Импорт данных,** которые необходимо разметить, из различных источников.
4.  **Настройка интерфейса разметки (Labeling Interface):** Определение того, как данные будут представлены аннотатору и какие инструменты будут ему доступны. Это делается либо выбором из готовых шаблонов, либо созданием кастомной XML-конфигурации.
5.  **Разметка данных (Annotate Tasks):** Непосредственное выполнение аннотирования задач специалистами-разметчиками.
6.  **Экспорт размеченных данных (аннотаций)** в одном из поддерживаемых форматов для последующего использования в обучении ML-моделей.

## 3. Установка (Installation)

Label Studio можно установить несколькими способами, в зависимости от ваших потребностей и технической подготовки:

*   **С помощью pip (рекомендуется для Python-разработчиков и интеграции в Python-проекты):**
    ```bash
    # Рекомендуется использовать виртуальное окружение
    python -m venv venv
    source venv/bin/activate  # для Linux/macOS
    # venv\Scripts\activate    # для Windows

    pip install label-studio
    label-studio start my_project --init # Запуск и инициализация нового проекта
    ```
    После этого Label Studio обычно доступен в браузере по адресу `http://localhost:8080`.

*   **С помощью Docker (рекомендуется для быстрого старта, изоляции зависимостей и простого развертывания):**
    ```bash
    docker run -p 8080:8080 -v $(pwd)/mydata:/label-studio/data heartexlabs/label-studio:latest
    ```
    *   `-p 8080:8080`: Пробрасывает порт 8080 контейнера на порт 8080 хост-машины.
    *   `-v $(pwd)/mydata:/label-studio/data`: Монтирует локальную папку `mydata` (в текущей директории) в папку `/label-studio/data` внутри контейнера. Это позволяет сохранять данные проектов Label Studio (SQLite база данных, загруженные файлы) на хост-машине, предотвращая их потерю при остановке или удалении контейнера.

*   **С помощью Docker Compose (для более сложных конфигураций, например, с отдельной базой данных PostgreSQL):**
    Официальный репозиторий Label Studio предоставляет примеры `docker-compose.yml` файлов.

*   **Из исходного кода (для разработчиков, желающих внести изменения в сам Label Studio):**
    Подробные инструкции по сборке из исходников доступны в официальной документации на GitHub.

*   **Облачные платформы и сервисы:**
    Компания HumanSignal (ранее Heartex), основной разработчик Label Studio, предлагает коммерческую облачную платформу Label Studio Enterprise, предоставляющую расширенные возможности для командной работы, безопасности и управления.

После успешного запуска, доступ к веб-интерфейсу Label Studio обычно осуществляется через браузер по адресу `http://localhost:8080` (если используется порт по умолчанию).

## 4. Создание проекта (Creating a Project)

1.  В главном интерфейсе Label Studio нажмите кнопку **"Create Project"**.
2.  **Введите имя проекта (Project Name)** (например, "Разметка отзывов клиентов" или "Детекция кошек на фото") и, опционально, его описание.
3.  **Настройка интерфейса разметки (Labeling Setup):**
    Это ключевой шаг, определяющий, как будут выглядеть ваши задачи и какие инструменты будут доступны разметчикам.
    *   **Использовать шаблон (Use a template):** Label Studio предлагает множество готовых шаблонов для типовых задач (например, "Image Bounding Boxes", "Text Classification", "Audio Transcription"). Это самый быстрый способ начать.
    *   **Создать собственную конфигурацию (Custom template / Browse Templates / Code):**
        *   **Визуальный конфигуратор:** Позволяет интерактивно добавлять и настраивать блоки для отображения данных (Image, Text, Audio и т.д.) и элементы управления для меток (Choices, RectangleLabels, TextArea и т.д.).
        *   **XML-конфигурация:** Для максимальной гибкости можно написать или отредактировать XML-код интерфейса напрямую. Это позволяет создавать очень сложные и специфические интерфейсы.
        *   **Пример XML-конфигурации для задачи детекции объектов (Bounding Boxes) на изображениях:**
            ```xml
            <View>
              <!-- Отображение изображения. "$image_url" - переменная, 
                   содержащая URL или путь к файлу изображения из ваших данных. -->
              <Image name="image_object" value="$image_url"/> 
              
              <!-- Определение меток для прямоугольных областей, 
                   связанных с объектом "image_object". -->
              <RectangleLabels name="object_labels" toName="image_object">
                <Label value="Автомобиль" background="green"/>
                <Label value="Пешеход" background="blue"/>
                <Label value="Светофор" background="orange"/>
              </RectangleLabels>
            </View>
            ```
4.  Сохраните настройки проекта. После этого вы сможете импортировать данные.

## 5. Импорт данных (Data Import / Project Storage)

После создания и настройки проекта необходимо загрузить данные для разметки. Label Studio предлагает несколько способов:

*   **Через пользовательский интерфейс (кнопка "Import" на странице проекта):**
    *   **Загрузка файлов (Upload Files):** Позволяет загружать файлы непосредственно с вашего локального компьютера.
    *   **Список URL-адресов:** Можно предоставить текстовый файл, где каждая строка содержит URL-адрес к данным (например, к изображениям в интернете).
    *   **Поддерживаемые форматы для импорта задач:**
        *   **Простые файлы:** Изображения (JPG, PNG, GIF и др.), аудио (WAV, MP3), видео (MP4), текстовые файлы (TXT).
        *   **CSV/TSV:** Для импорта структурированных данных, где каждая строка представляет задачу, а столбцы содержат сами данные (например, текст) или ссылки на файлы данных и их метаданные.
        *   **JSON:** Для импорта задач в формате Label Studio, что особенно полезно для импорта данных с уже существующей предразметкой или для миграции проектов.
        *   **CONLL (для NER):** Специализированный формат для задач извлечения именованных сущностей.

*   **Подключение облачного хранилища (Cloud Storage):**
    В настройках проекта (`Settings -> Cloud Storage`) можно настроить синхронизацию с:
    *   **Amazon S3** (и S3-совместимыми хранилищами, например, MinIO)
    *   **Google Cloud Storage (GCS)**
    *   **Microsoft Azure Blob Storage**
    Это позволяет Label Studio автоматически обнаруживать новые файлы в указанном бакете (контейнере) и создавать из них задачи, а также экспортировать результаты разметки обратно в облако. Требуется корректная настройка прав доступа и учетных данных.

Данные в Label Studio представляются в виде **задач (tasks)**. Каждая задача – это одна атомарная единица данных, которую необходимо разметить (например, одно изображение, один текстовый фрагмент, одна аудиозапись).

## 6. Интеграция с машинным обучением (Machine Learning Integration)

Одной из мощных возможностей Label Studio является интеграция с моделями машинного обучения через так называемые **ML-бэкенды (ML Backends)**. Это позволяет:

*   **Предварительная разметка (Pre-annotation / Predictions):** Модель, подключенная как ML-бэкенд, может автоматически генерировать начальные аннотации для новых задач. Разметчики затем проверяют, корректируют или дополняют эти предсказания, что значительно ускоряет процесс, особенно для больших объемов данных.
*   **Активное обучение (Active Learning):** Модель может помогать выбирать наиболее "неопределенные" или информативные задачи для разметки, что позволяет более эффективно улучшать производительность модели с меньшими затратами на ручную аннотацию.
*   **Непрерывное обучение (Continuous Training):** Можно настроить цикл, в котором по мере поступления новых размеченных данных модель автоматически дообучается, и обновленная версия модели используется для предразметки последующих задач.

**Принцип работы ML-бэкенда:**

1.  Разрабатывается и запускается **ML-бэкенд** – это, как правило, Python-скрипт или веб-сервис (например, на Flask или FastAPI), который использует `label-studio-ml-sdk`. Этот бэкенд содержит логику загрузки вашей обученной ML-модели и предоставления предсказаний.
2.  В настройках проекта Label Studio (`Settings -> Machine Learning`) указывается URL-адрес запущенного ML-бэкенда.
3.  При открытии новой задачи или по специальному запросу Label Studio отправляет данные задачи на ML-бэкенд.
4.  ML-бэкенд обрабатывает данные с помощью модели и возвращает предсказанные аннотации в формате Label Studio.

Существует множество [примеров ML-бэкендов](https://github.com/HumanSignal/label-studio-ml-backend/tree/master/label_studio_ml/examples) для различных задач и моделей.

## 7. Экспорт аннотаций (Data Export)

После того как данные размечены (полностью или частично), их можно экспортировать для использования в обучении моделей машинного обучения или для других целей анализа.

1.  На странице проекта нажмите кнопку **"Export"**.
2.  **Выберите формат экспорта.** Label Studio предлагает широкий выбор форматов:
    *   **JSON:** Наиболее полный и рекомендуемый формат по умолчанию. Содержит все детали аннотаций, информацию о разметчиках, временные метки и структуру исходных данных.
    *   **JSON-MIN:** Упрощенная версия JSON, содержащая только аннотации.
    *   **CSV/TSV:** Табличный формат, удобен для задач классификации или когда аннотации можно представить в виде таблицы.
    *   **COCO JSON:** Стандартный формат для задач детекции объектов и сегментации экземпляров.
    *   **Pascal VOC XML:** Классический формат для задач детекции объектов.
    *   **YOLO:** Формат для моделей детекции объектов семейства YOLO.
    *   **CONLL2003:** Формат для задач извлечения именованных сущностей (NER).
    *   И другие форматы, специфичные для аудио (ASR Manifest) или других типов задач.

Экспортированные файлы содержат размеченные данные, готовые к дальнейшей обработке и загрузке в фреймворки машинного обучения.

## 8. Ключевые преимущества Label Studio (Резюме)

*   **Гибкость:** Возможность тонкой настройки интерфейса разметки под любую, даже самую нестандартную задачу.
*   **Универсальность:** Поддержка широчайшего спектра типов данных и задач аннотирования в одном инструменте.
*   **Интеграция с ML:** Мощные возможности для автоматизации и ускорения процесса разметки с помощью ML-бэкендов (предразметка, активное обучение).
*   **Открытый исходный код и активное сообщество:** Гарантирует бесплатное использование, возможность доработки, постоянное развитие инструмента и доступ к поддержке со стороны сообщества.
*   **Командная работа:** Функции для организации работы нескольких пользователей и контроля качества аннотаций.
